name: Version Bump

on:
  push:
    branches:
      - master

jobs:
  build:
    runs-on: windows-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v2
      
      - name: Set up .NET
        uses: actions/setup-dotnet@v1
        with:
          dotnet-version: '6.0.100-preview.7.21379.14'

      - name: Version Bump
        run: |
          $version = [System.Version](Get-Content -Path $env:GITHUB_WORKSPACE/AS2_WEB/Properties/AssemblyInfo.cs | Select-String -Pattern 'AssemblyFileVersion\("(\d+\.\d+\.\d+\.)(\d+)"\)' | ForEach-Object { $_.Matches.Groups[1].Value + ($_.Matches.Groups[2].Value -as [int] + 1) })
          (Get-Content -Path $env:GITHUB_WORKSPACE/AS2_WEB/Properties/AssemblyInfo.cs) -replace 'AssemblyFileVersion\("(\d+\.\d+\.\d+\.)(\d+)"\)', ('AssemblyFileVersion("{0}")' -f $version) | Set-Content -Path $env:GITHUB_WORKSPACE/MyProject/Properties/AssemblyInfo.cs
          
      - name: Commit and push changes
        run: |
          git config user.name "Anthony Peiris"
          git config user.email "mapeiris@hotmail.com"
          git add .
          git commit -m "Bump version number"
          git push origin main
